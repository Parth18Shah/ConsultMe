{% extends "layout.html" %}
{% block body %}
<!-- <script>
    function ajax() {

        var req = new XMLHttpRequest();
        req.onreadystatechange = function () {
            if (req.readyState == 4 && req.status == 200) {
                document.getElementById('chat').innerHTML = req.responseText;
            }
        }
        req.open('POST', '/consult', true);
        req.send();
    }
    setInterval(function () { ajax() }, 10);
</script> -->
<!-- <div class="bg-gra-02" onload="ajax();"> -->
<div class="bg-gra-02">
    <div class="p-t-130 font-poppins " style="display:flex; padding-bottom:80px ; ">
        <div class="wrapper " style="width: 40vw;">
            <div class="chat bg-dark card_body">
                <div class=" card-body">

                    <h2 class="predict-h2">Recent Chats</h2>
                    <div class="">
                        <div class="row form-group has-search" style="display: flex;">

                            <input type="text" id="myInput" class="input--style-4 form-control"
                                placeholder="Enter a name" onkeyup="myFunction()">

                            <ul class="container navbar-nav" id="myUL">
                                <form action="/consult" method="POST">
                                    {% if doctors_list is defined %}
                                    {% for doctor in doctors_list %}
                                    <li class="item3 msg_received"
                                        style="display: flex; flex-direction: column; margin: 5px; margin-top: 20px;border: 2px ridge black;">
                                        <div class=" " style="display: flex;">
                                            <img src='https://picsum.photos/200/300' class="rounded-circle user_img_msg"
                                                width="40" height="40" style="border: 2px ridge black;">
                                            <h5 style="display: flex;">
                                                <a class="nav-link"class="a" style="color: black
                                                ;">@{{doctor.username}} </a>
                                            </h5>
                                        </div>
                                        <hr>
                                        <p style="margin-top: 10px;">Specialization: {{doctor.specialist}}</p>
                                        <span class="" style="color: black;">Having {{doctor.experience}} of
                                            Experience</span>
                                        <button type="submit" name='chat-btn' class="btn btn--blue btn--radius-2"
                                            value="{{doctor.id}}">Chat</button>
                                    </li>

                                    {% endfor %}
                                    {% else %}
                                    {% for users in users_list %}
                                    <li class="item3 msg_received"
                                        style="display: flex; flex-direction: column; margin: 5px; margin-top: 20px; border: 2px ridge black;">
                                        <div class=" " style="display: flex;">
                                            <img src='https://picsum.photos/200/300' class="rounded-circle user_img_msg"
                                                width="40" height="40" style="border: 2px ridge black;">
                                            <h5><a class="nav-link" class="a" style="color: black
                                        ;">@{{users.username}} </a>
                                                <p style="color: black;">Email-id :- {{users.email}} </p>
                                            </h5>
                                        </div>
                                        <button type="submit" name='chat-btn' class="btn btn--blue btn--radius-2"
                                            value="{{users.id}}">Chat</button>
                                    </li>
                                    {% endfor %}
                                    {% endif %}
                                </form>
                            </ul>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="wrapper " style="width: 55vw;">

            <div class="bg-dark msg_card_body col-sm-12 ">
                <div class="chat">
                    <h2 class="predict-h2">Chat Box<svg style="margin: 0px 10px;" xmlns="http://www.w3.org/2000/svg"
                            width="25" height="25" fill="black" class="bi bi-chat-fill" viewBox="0 0 16 16">
                            <path
                                d="M8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6-.097 1.016-.417 2.13-.771 2.966-.079.186.074.394.273.362 2.256-.37 3.597-.938 4.18-1.234A9.06 9.06 0 0 0 8 15z" />
                        </svg></h2>

                    {% if chats is defined %}
                    <button class="item3 " type="submit"
                        style="display: flex; flex-direction: column; margin: 5px; margin-top: 20px; background-color:#a5dbec;border-radius: 10px;width: 100%; border:2px solid black"
                       >
                        <div class=" " style="display: flex;justify-content:space-between;align-items: center;">
                            <img style="border: 2px solid black;" src='https://picsum.photos/200/300'
                                class="rounded-circle user_img_msg" width="40" height="40">
                            <h5 style="flex: 1;"><a class="nav-link" href="/profile" class="a" style="color: black
                                                ;">@{{selected_user.u_name}} </a>
                            </h5>
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-camera-fill" viewBox="0 0 16 16" style="margin-left:20rem">
                                <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
                                <path
                                    d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-paperclip" viewBox="0 0 16 16" style="margin-left: 10px;">
                                <path
                                    d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-justify-right" viewBox="0 0 16 16" style="margin-left: 10px;">
                                <path fill-rule="evenodd"
                                    d="M6 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-4-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z" />
                            </svg>
                        </div>

                    </button>
                    {% for chat in chats %}
                    {% if chat.senderid != uid %}

                    <div class="d-flex container justify-content-start mb-4">
                        <!-- done -->
                        <div class="img_cont_msg">
                            <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg"
                                class="rounded-circle user_img_msg" width="30" height="30">
                            <p style="color: whitesmoke;margin: 5px">{{selected_user.u_name}} </p>
                        </div>
                        <div style="display: flex; flex-direction: column; margin: 5px;">
                            <div class="talk-bubble-send tri-right left-top">
                                <h5 class="msg_send">{{chat.message}}</h5>
                            </div>
                            <span class="time">{{ chat.send_time }} </span>
                        </div>

                    </div>
                    <!-- <div class="" style="text-align:right; padding:2px 5px;">
                                    <p>
                                        <span class="" style="background-color: #28a7ab;color: #fff;margin: 1px 0;padding: 6px 12px; border-radius: 12px;"> {{chat.message}}</span>
                                    </p>
                                </div> -->
                    {% else %}
                    <div class="d-flex container justify-content-end mb-4">

                        <div style="display: flex; flex-direction: column; margin: 5px;">
                            <div class="talk-bubble-receive tri-right btm-right">
                            <h5 class="msg_received ">{{chat.message}}</h5>
                            </div>
                            <span class="time"> {{chat.send_time}} </span>
                        </div>
                        <!-- <div class="img_cont_msg">
                                    <p class="card-title" style="color: whitesmoke;">You </p>
                                    <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg"
                                        class="rounded-circle user_img_msg" width="30" height="30">
                                </div> -->
                    </div>
                    <!-- <div class="" style="text-align:left; padding:2px 5px;">
                                    <p>
                                        <span class="" style="background-color: #dd92b2;color: #fff;margin: 1px 0;padding: 6px 12px; border-radius: 12px;"> {{chat.message}}</span>
                                    </p>
                                </div> -->
                    {% endif %}
                    {% endfor %}
                    <div class="card-footer " style="margin-top: auto;">
                        <div>
                            <form method="POST" action="/chat" autocomplete="off">
                                <div class="input--style-5 ">

                                    <input name="message" class=" form-control"
                                        placeholder="Type your message..."></input>
                                    <button type="submit" class="btn btn--blue btn--radius-2 " autofocus=""
                                        style="width :50ve; max-width: fit-content; display: flex; float: right; margin: 5px;">
                                        Send
                                    </button>
                                </div>
                            </form>
                        </div>
                        <!-- {{ form.message.label(class="input--style-5 form-control-label") }}
                
                                        {% if form.message.errors %}
                                            {{ form.message(class="form-control form-control-lg is-invalid") }}
                                            <div class="invalid-feedback">
                                                {% for error in form.message.errors %}
                                                    <span>{{ error }}</span>
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            {{ form.message(class="form-control form-control-lg") }}
                                        {% endif %} -->
                        <!-- <div >
                                            <button type="submit" class="btn btn--blue btn--radius-2 " autofocus="" style="max-width: fit-content; display: flex; float: right; margin: 5px;">
                                                Send
                                            </button>
                                        </div> -->
                        <!-- <button type="submit" class="btn btn--blue btn--radius-2 " style="display: flex; width: max-content;" autofocus="">
                                            Send
                                        </button> -->

                    </div>
                </div>
                {% else %}
                <p class="b" style="text-align: center;">Please select a user to chat with.</p>
                {% endif %}





            </div>
        </div>
    </div>
</div>
<script>

    function myFunction() {
        var input, filter, ul, li, a, i, txtValue;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        ul = document.getElementById("myUL");
        li = ul.getElementsByTagName("li");
        for (i = 0; i < li.length; i++) {
            a = li[i].getElementsByTagName("a")[0];
            txtValue = a.textContent || a.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                li[i].style.display = "";
            } else {
                li[i].style.display = "none";
            }
        }
    }



</script>


{% endblock %}



<!-- https://codepen.io/blackcityhenry/pen/LXOOgW -->